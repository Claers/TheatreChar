<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Chat Théatre</title>
    </head>
 
    <body>
    <div id="header">
        <h1 id="title"> Chat du club théatre </h1>
    </div>
     <div id="login">
     <form id="log">
        Id :
        <input type="text" id="Id">
        <br>
        Mdp : 
        <input type="password" id="mdp">
        <br><br>
        <input type="submit" value="Se connecter">
        </form>
    </div>

    <div id="chatbox">
            
        </div>
    <div id="message">
         <form id="mess">
        <p> Message : </p>
        <input type="text" id="m" autocomplete="off">
        <br>
        <input type="submit" value="Envoyer" id='send'>
        </form>

    </div>
        
        <script src="https://code.jquery.com/jquery-1.10.1.min.js"></script>
        <script src="/socket.io/socket.io.js"></script>

        <script>
            var messageaud = new Audio('http://s1.vocaroo.com/media/download_temp/Vocaroo_s0LCBZE8vRjv.mp3');
                $("#message").hide();
            
            var connecaud = new Audio("http://vocaroo.com/media_command.php?media=s0I5xPb1yGTP&command=download_mp3");

            var discaudio = new Audio("http://vocaroo.com/media_command.php?media=s0I5xPb1yGTP&command=download_mp3");
            var url = window.location.href;
            var socket = io.connect(url);

            socket.on('error', function() {
                location.reload();
            });

            
            socket.on('username', function(username){
                user = username;
                connecaud.play();
                 $('#chatbox').append('<p> <strong>' + user + " c'est connecté !" + ' </strong> </p>');
                 scroll();

            });

            socket.on('login',function(ok){
                    if (ok == 'log') {
                        $("#message").show();
                        $("#login").hide();
                    }
                    if (ok == 'incorrect'){
                        alert("Incorrect");
                    }
                    if (ok == 'reload'){
                        location.reload();
                    }
            });

            socket.on('disco', function(user){
                $('#chatbox').append('<p> <strong>' + user + " c'est déconnecté !" + ' </strong> </p>');
                scroll();
                discaudio.play();
            })
            socket.on('logs', function(logs){
                logs.forEach(function(save){
                    $('#chatbox').append('<p>' + save + '</p>');
                });
                 scroll();
                
            });
            $('#log').submit(function(){
                var logs = { userid : $('#Id').val() , password : $('#mdp').val() };
                socket.emit('login', logs);
                var logs = {};
                return false;
              });

            $('#mess').submit(function () {
                if ($('#m').val().length == 0){
                    return false;
                }
                else if($('#m').val().length > 0){
                    var message = $('#m').val();
                    socket.emit('message', message);
                    $('#m').val('');
                    
                    return false;
                }
            });

            socket.on('message', function(data) {
                insereMessage(data.user, data.message)
                messageaud.play();
                scroll();
            })

             socket.on('messageu', function(data) {
                insereMessage(data.user, data.message)
                scroll();
            })

             function isEmpty(str) {
                 return (!str || 0 === str.length);
            }
        function insereMessage(user, message) {
                $('#chatbox').append('<p><strong>' + user + ' : </strong> ' + message + '</p>');
            }


            function scroll(){
                var div = document.getElementById('chatbox');
                div.scrollTop = '1000000';
            }
        </script>



        <style>
        #login {

              padding-top: 40px;
              text-align: center;
               }

        #login #mdp{
              margin-right: 18px;
        }
        #chatbox{
        margin-top: 50px;
        position:fixed;
        height: 800px;
        width: 99%;
        overflow-y:auto;
        float: left;
        word-break: break-all;
        position: relative;
        margin-left: 5px;
        border-radius: 5px;
        border : 1px solid;
        box-shadow: 1px 1px 2px #888888, 1px 1px 2px #888888;
        }
        #message{
            position: fixed;
            position: absolute; 
            bottom:20px;
            padding-left: 0px;
            padding-right: 92%;
        }

        #message #send{
            position: absolute; 
            margin-left: 100%;
            float: right;
            bottom:1%;

        }
        #message #m{
            bottom:1%;
            margin-left: 5px;
            position: absolute;
            width: 90%;
        }
        #header{
            text-align: center;
            background-color: #e74c3c;
           
        }
        body{
            margin-top: 0;
            margin:0;

        }
        html{
            margin-top:0;
            margin:0;
        }
        #title{
            margin:0;
            color:white;
            text-shadow: 1px 0 0 #000, -1px 0 0 #000, 0 1px 0 #000, 0 -1px 0 #000, 1px 1px #000, -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000;
        }

        </style>
    </body>
</html>