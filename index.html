<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Socket.io</title>
    </head>
 
    <body>
     <div id="login">
     <form id="log">
        Identifiant :
        <input type="text" id="Id">
        Mot de passe : 
        <input type="password" id="mdp">
        <br><br>
        <input type="submit" value="Se connecter">
        </form>
    </div>
    <div id="message">
         <form id="mess">
        <p> Message : </p>
        <input type="text" id="m" autocomplete="off">
        <br>
        <input type="submit" value="Envoyer">
        </form>
<p> Chat : </p>
        <div id="chatbox">
            
        </div>
    </div>
        <script src="https://code.jquery.com/jquery-1.10.1.min.js"></script>
        <script src="/socket.io/socket.io.js"></script>

        <script>
            var url = window.location.href;
            var socket = io.connect(url);
            
            socket.on('username', function(username){
                user = username;
            });

            socket.on('login',function(ok){
                    if (ok) {
                        $("#message").show();
                        $("#login").hide();
                    }
            });
            socket.on('logs', function(logs){
                logs.forEach(function(save){
                    $('#chatbox').prepend('<p>' + save + '</p>');
                });
                
            });
            $('#log').submit(function(){
                var logs = { userid : $('#Id').val() , password : $('#mdp').val() };
                socket.emit('login', logs);
                var logs = {};
                return false;
              });

            $('#mess').submit(function () {
                var message = $('#m').val();
                socket.emit('message', message);
                insereMessage(user, message)

                $('#m').val('');
                return false;
            }) 

            socket.on('message', function(data) {
                insereMessage(data.user, data.message)
            })

        function insereMessage(user, message) {
                $('#chatbox').prepend('<p><strong>' + user + ' : </strong> ' + message + '</p>');
            }
        </script>
    </body>
</html>